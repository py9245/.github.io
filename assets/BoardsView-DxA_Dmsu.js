import{r as i,l as B,o as D,u as F,c as s,a as e,k as m,m as M,p as b,v as k,t as u,q as N,F as P,f as V,s as C,i as o,x as I}from"./index-Co5VzuHj.js";const L={class:"panel"},T={key:0,class:"post-form"},q={class:"input-group"},z={class:"input-group"},E={class:"post-upload",for:"post-attachment"},U=["disabled"],$={key:0},j={key:1},K={key:1,class:"post-locked"},R={key:2,class:"post-success"},W={key:3,class:"post-error"},G={key:4,class:"posts-empty"},H={key:5,class:"posts-empty"},J={key:6,class:"posts-list"},O={class:"post-card__meta"},Q={class:"post-author"},X={key:0,class:"post-body"},Y=["href"],et={__name:"BoardsView",setup(Z){const{profile:_,ensureProfileLoaded:g}=F(),c=i([]),y=i(!0),r=i(""),d=i(""),p=i(!1),l=B({title:"",body:"",attachment:null}),h=i(""),f=i(null),x=a=>{if(!a)return"";const t=typeof a=="string"?new Date(a):a;return Number.isNaN(t.getTime())?"":new Intl.DateTimeFormat("ko-KR",{dateStyle:"long",timeStyle:"short"}).format(t)},w=a=>{const[t]=a.target.files||[];l.attachment=t||null,h.value=t?`${t.name} (${(t.size/(1024*1024)).toFixed(2)}MB)`:""},S=()=>{l.attachment=null,h.value="",f.value&&(f.value.value="")},v=async()=>{y.value=!0;try{const a=await C();c.value=Array.isArray(a?.posts)?a.posts:[]}catch(a){console.error(a),r.value="게시글을 불러오지 못했습니다."}finally{y.value=!1}},A=async()=>{if(r.value="",d.value="",!_.value){r.value="로그인 후 이용해 주세요.";return}if(!l.title.trim()){r.value="제목을 입력해 주세요.";return}p.value=!0;try{const a=new FormData;a.append("title",l.title.trim()),a.append("body",l.body.trim()),l.attachment&&a.append("attachment",l.attachment);const t=await I(a);c.value=[t,...c.value],l.title="",l.body="",S(),d.value="게시글이 등록되었습니다."}catch(a){console.error(a),r.value=a?.payload?.detail||(Array.isArray(a?.payload?.non_field_errors)?a.payload.non_field_errors.join(" "):"게시글을 저장하지 못했습니다.")}finally{p.value=!1}};return D(async()=>{await Promise.all([g(),v()])}),(a,t)=>(o(),s("section",L,[e("header",{class:"panel-header"},[t[2]||(t[2]=e("div",null,[e("h2",null,"파일 첨부 게시판"),e("p",null,"첨부파일은 AWS S3에 저장되며 한 계정당 하루 5개까지 작성 가능합니다.")],-1)),e("button",{class:"ghost-btn",type:"button",onClick:v},"새로 고침")]),M(_)?(o(),s("div",T,[e("form",{autocomplete:"off",onSubmit:N(A,["prevent"])},[e("label",q,[t[3]||(t[3]=e("span",null,"제목",-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>l.title=n),placeholder:"게시글 제목",required:""},null,512),[[k,l.title]])]),e("label",z,[t[4]||(t[4]=e("span",null,"내용",-1)),b(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.body=n),rows:"5",placeholder:"전하고 싶은 이야기를 적어보세요"},null,512),[[k,l.body]])]),e("label",E,[t[5]||(t[5]=e("strong",null,"첨부파일",-1)),e("span",null,u(h.value||"최대 5MB, 이미지·문서 업로드 지원"),1)]),e("input",{id:"post-attachment",ref_key:"attachmentInput",ref:f,type:"file",accept:"image/*,application/pdf,application/zip,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt",onChange:w},null,544),e("button",{class:"primary-btn",disabled:p.value,type:"submit"},[p.value?(o(),s("span",$,"업로드 중...")):(o(),s("span",j,"게시글 등록"))],8,U),t[6]||(t[6]=e("p",{class:"post-hint"},"파일은 최대 5MB, 하루 5개의 게시글 제한이 적용됩니다.",-1))],32)])):(o(),s("div",K,"로그인한 사용자만 게시글을 작성할 수 있습니다.")),d.value?(o(),s("p",R,u(d.value),1)):m("",!0),r.value?(o(),s("p",W,u(r.value),1)):m("",!0),y.value?(o(),s("div",G,"게시글을 불러오는 중...")):c.value.length?(o(),s("div",J,[(o(!0),s(P,null,V(c.value,n=>(o(),s("article",{key:n.id,class:"post-card"},[e("div",O,[e("h3",null,u(n.title),1),e("div",null,[e("span",Q,"@"+u(n.author?.username||"알 수 없음"),1),e("time",null,u(x(n.created_at)),1)])]),n.body?(o(),s("p",X,u(n.body),1)):m("",!0),n.attachment_url?(o(),s("a",{key:1,href:n.attachment_url,class:"post-attachment",target:"_blank",rel:"noreferrer"}," 첨부파일 다운로드 ",8,Y)):m("",!0)]))),128))])):(o(),s("div",H,"아직 게시글이 없습니다. 첫 글을 남겨보세요!"))]))}};export{et as default};
