import{l as b,r as f,y as R,u as T,o as z,c as l,a as s,k as F,m as P,t as w,q,p as i,v as d,z as I,A as O,i as n,B as G,C as H,D as J,E as K}from"./index-Co5VzuHj.js";const Q={class:"panel"},W={key:0,class:"authed-grid"},X={class:"authed-card"},Y={class:"authed-profile"},Z=["src"],$={class:"authed-name"},ss={class:"authed-email"},es={class:"authed-bio"},as={class:"authed-card"},os={class:"input-group"},ts={class:"input-group"},ls=["disabled"],ns={key:0},rs={key:1},us={class:"authed-card"},is=["disabled"],ds={key:0},ps={key:1},cs={class:"authed-card"},ms={class:"input-group"},ys={class:"input-group"},fs=["disabled"],vs={key:0},_s={key:1},bs={key:1,class:"auth-grid"},ws={class:"input-group"},hs={class:"input-group"},gs={class:"input-group"},ks=["disabled"],Us={key:0},Vs={key:1},Ps={class:"input-group"},qs={class:"input-group"},Cs=["disabled"],Fs={key:0},Ss={key:1},As={key:2,class:"auth-message success"},Ds={key:3,class:"auth-message error"},Bs={__name:"AccountsView",setup(xs){const{profile:u,setSession:v,clearSession:A,ensureProfileLoaded:D}=T(),r=b({username:"",email:"",password:""}),p=b({username:"",password:""}),c=b({display_name:"",bio:""}),m=b({current_password:"",new_password:""}),_=f(null),o=b({success:"",error:""}),h=f(!1),g=f(!1),k=f(!1),U=f(!1),V=f(!1),S=R(()=>u.value?.avatar_url||""),y=()=>{o.success="",o.error=""},C=()=>{c.display_name=u.value?.display_name||"",c.bio=u.value?.bio||""},x=async()=>{y(),h.value=!0;try{const a=await J({username:r.username.trim(),email:r.email.trim(),password:r.password});v(a.token,a.profile),C(),r.username="",r.email="",r.password="",o.success="회원가입이 완료되었습니다."}catch(a){o.error=a?.payload?.detail||"회원가입에 실패했습니다."}finally{h.value=!1}},j=async()=>{y(),g.value=!0;try{const a=await K({username:p.username.trim(),password:p.password});v(a.token,a.profile),C(),p.username="",p.password="",o.success="로그인이 완료되었습니다."}catch(a){o.error=a?.payload?.detail||"로그인에 실패했습니다."}finally{g.value=!1}},B=async()=>{y();try{await I()}catch(a){console.warn("로그아웃 요청 실패",a)}finally{A(),o.success="로그아웃되었습니다."}},L=async()=>{y(),k.value=!0;try{const a=await G({display_name:c.display_name,bio:c.bio});v(void 0,a.profile),o.success="프로필을 업데이트했습니다."}catch(a){o.error=a?.payload?.detail||"프로필을 수정하지 못했습니다."}finally{k.value=!1}},M=a=>{const[e]=a.target.files||[];_.value=e||null},E=async()=>{if(_.value){y(),V.value=!0;try{const a=new FormData;a.append("avatar",_.value);const e=await O(a);v(void 0,e.profile),_.value=null,o.success="아바타를 업데이트했습니다."}catch(a){o.error=a?.payload?.detail||"아바타 업로드에 실패했습니다."}finally{V.value=!1}}},N=async()=>{y(),U.value=!0;try{const a=await H({current_password:m.current_password,new_password:m.new_password});a?.token&&v(a.token,u.value),m.current_password="",m.new_password="",o.success="비밀번호가 변경되었습니다."}catch(a){o.error=a?.payload?.detail||(a?.payload&&typeof a.payload=="object"?Object.values(a.payload).flat().join(" "):"비밀번호를 변경하지 못했습니다.")}finally{U.value=!1}};return z(async()=>{await D(),u.value&&C()}),(a,e)=>(n(),l("section",Q,[e[24]||(e[24]=s("header",{class:"panel-header"},[s("div",null,[s("h2",null,"계정 관리"),s("p",null,"Django Token 인증 기반으로 회원정보를 조회·수정합니다.")])],-1)),P(u)?(n(),l("div",W,[s("article",X,[s("header",null,[e[9]||(e[9]=s("h3",null,"내 계정",-1)),s("button",{class:"ghost-btn",type:"button",onClick:B},"로그아웃")]),s("div",Y,[S.value?(n(),l("img",{key:0,src:S.value,alt:"avatar"},null,8,Z)):F("",!0),s("div",null,[s("p",$,w(P(u).user.username),1),s("p",ss,w(P(u).user.email||"이메일 정보 없음"),1),s("p",es,w(P(u).bio||"소개글이 없습니다."),1)])])]),s("article",as,[e[12]||(e[12]=s("h3",null,"프로필 수정",-1)),s("form",{class:"auth-form",autocomplete:"off",onSubmit:q(L,["prevent"])},[s("label",os,[e[10]||(e[10]=s("span",null,"표시 이름",-1)),i(s("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>c.display_name=t),placeholder:"공개 이름"},null,512),[[d,c.display_name]])]),s("label",ts,[e[11]||(e[11]=s("span",null,"소개",-1)),i(s("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>c.bio=t),rows:"3",placeholder:"자기 소개를 입력해 주세요"},null,512),[[d,c.bio]])]),s("button",{class:"primary-btn",disabled:k.value,type:"submit"},[k.value?(n(),l("span",ns,"저장 중...")):(n(),l("span",rs,"프로필 저장"))],8,ls)],32)]),s("article",us,[e[13]||(e[13]=s("h3",null,"아바타",-1)),s("input",{type:"file",accept:"image/*",onChange:M},null,32),s("button",{class:"ghost-btn",disabled:V.value||!_.value,type:"button",onClick:E},[V.value?(n(),l("span",ds,"업로드 중...")):(n(),l("span",ps,"아바타 업로드"))],8,is)]),s("article",cs,[e[16]||(e[16]=s("h3",null,"비밀번호 변경",-1)),s("form",{class:"auth-form",autocomplete:"off",onSubmit:q(N,["prevent"])},[s("label",ms,[e[14]||(e[14]=s("span",null,"현재 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>m.current_password=t),type:"password",required:""},null,512),[[d,m.current_password]])]),s("label",ys,[e[15]||(e[15]=s("span",null,"새 비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>m.new_password=t),type:"password",minlength:"8",required:""},null,512),[[d,m.new_password]])]),s("button",{class:"primary-btn",disabled:U.value,type:"submit"},[U.value?(n(),l("span",vs,"변경 중...")):(n(),l("span",_s,"비밀번호 변경"))],8,fs)],32)])])):(n(),l("div",bs,[s("form",{class:"auth-form",autocomplete:"off",onSubmit:q(x,["prevent"])},[e[20]||(e[20]=s("h3",null,"회원가입",-1)),s("label",ws,[e[17]||(e[17]=s("span",null,"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>r.username=t),placeholder:"예) new_user",minlength:"3",required:""},null,512),[[d,r.username]])]),s("label",hs,[e[18]||(e[18]=s("span",null,"이메일",-1)),i(s("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>r.email=t),type:"email",placeholder:"you@example.com",required:""},null,512),[[d,r.email]])]),s("label",gs,[e[19]||(e[19]=s("span",null,"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>r.password=t),type:"password",placeholder:"8자 이상",minlength:"8",required:""},null,512),[[d,r.password]])]),s("button",{class:"primary-btn",disabled:h.value,type:"submit"},[h.value?(n(),l("span",Us,"가입 중...")):(n(),l("span",Vs,"회원가입"))],8,ks)],32),s("form",{class:"auth-form",autocomplete:"off",onSubmit:q(j,["prevent"])},[e[23]||(e[23]=s("h3",null,"로그인",-1)),s("label",Ps,[e[21]||(e[21]=s("span",null,"아이디",-1)),i(s("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>p.username=t),placeholder:"아이디를 입력하세요",required:""},null,512),[[d,p.username]])]),s("label",qs,[e[22]||(e[22]=s("span",null,"비밀번호",-1)),i(s("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>p.password=t),type:"password",placeholder:"비밀번호를 입력하세요",required:""},null,512),[[d,p.password]])]),s("button",{class:"primary-btn",disabled:g.value,type:"submit"},[g.value?(n(),l("span",Fs,"로그인 중...")):(n(),l("span",Ss,"로그인"))],8,Cs)],32)])),o.success?(n(),l("p",As,w(o.success),1)):F("",!0),o.error?(n(),l("p",Ds,w(o.error),1)):F("",!0)]))}};export{Bs as default};
